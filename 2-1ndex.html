<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- v2.0: S-Class ÌõàÎ†® Î≤ÑÏ†ÑÏúºÎ°ú ÌÉÄÏù¥ÌãÄ Î≥ÄÍ≤Ω -->
    <title>Ï™ºÍ∞úÍ∏∞ ÎßàÏä§ÌÑ∞ v2.0 (S-Class ÌõàÎ†®)</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4A80F3;
            --text-color: #333333;
            --light-bg-color: #f9f9f9;
            --border-color: #e0e0e0;
            --success-color: #28a745;
            --warning-color: #fd7e14;
            --danger-color: #dc3545;
            --white-color: #FFFFFF;
            --font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--white-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

       .container {
            width: 100%;
            max-width: 800px;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 36px;
            font-weight: 800;
            margin: 0;
            color: var(--primary-color);
        }

        header p {
            font-size: 18px;
            color: #666;
            margin-top: 8px;
        }

        #error-banner {
            background-color: var(--danger-color);
            color: var(--white-color);
            padding: 16px 24px;
            border-radius: 8px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        #error-message { font-weight: 600; margin: 0; }
        #error-close {
            background: none; border: none; color: var(--white-color);
            font-size: 24px; font-weight: 700; cursor: pointer;
            padding: 0 8px; line-height: 1; opacity: 0.8; transition: opacity 0.2s;
        }
        #error-close:hover { opacity: 1; }

       .main-card {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }

        /* --- ÏûÖÎ†• ÏÑπÏÖò --- */
        #input-section h2, #analysis-section h2, #feedback-report-section h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }
         #input-section h2:first-of-type { margin-top: 0; }

        #text-input {
            width: 100%; height: 200px; padding: 16px;
            border: 1px solid var(--border-color); border-radius: 8px;
            font-family: var(--font-family); font-size: 16px;
            resize: vertical; box-sizing: border-box; margin-bottom: 8px;
        }

        #char-counter {
            text-align: right; font-size: 14px;
            font-weight: 500; color: var(--danger-color);
        }
        #char-counter.sufficient {
            color: var(--success-color); font-weight: 600;
        }

       .course-options { margin-top: 24px; display: flex; gap: 16px; }
       .course-option {
            flex: 1; padding: 16px; border: 1px solid var(--border-color);
            border-radius: 8px; cursor: pointer; transition: all 0.2s ease;
            text-align: center;
        }
       .course-option:hover,.course-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 128, 243, 0.2);
        }
       .course-option h3 { margin: 0 0 8px 0; font-size: 16px; font-weight: 600; }
       .course-option p { margin: 0; font-size: 14px; color: #666; }

       .btn {
            display: block; width: 100%; padding: 16px;
            margin-top: 24px; background-color: var(--primary-color);
            color: var(--white-color); border: none; border-radius: 8px;
            font-size: 18px; font-weight: 700; cursor: pointer;
            transition: background-color 0.2s ease; box-sizing: border-box;
        }
       .btn-secondary { background-color: #6c757d; margin-top: 32px; }
       .btn-secondary:hover { background-color: #5a6268; }
       .btn:hover { background-color: #3a6cc7; }
       .btn:disabled { background-color: #a0b9e8; cursor: not-allowed; }

        /* --- [v2.0] ÌõàÎ†® ÏÑπÏÖò (Ìè¨Ïª§Ïä§ Î™®Îìú) --- */
        #analysis-section h2 {
            text-align: center;
            border-bottom: none; /* Ìè¨Ïª§Ïä§ Î™®ÎìúÏóêÏÑúÎäî Ï†úÎ™© Î∞ëÏ§Ñ Ï†úÍ±∞ */
            margin-bottom: 8px;
        }
        #progress-indicator {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 24px; /* Ïπ¥ÎìúÏôÄ Í∞ÑÍ≤© */
        }

        /* ÌõàÎ†® Ïπ¥Îìú (Îã®Ïùº) */
       .chunk-card {
            background: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px; /* Î≤ÑÌäºÍ≥º Í∞ÑÍ≤© */
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr 1.5fr; /* Ï¢åÏö∞ Î∂ÑÌï† */
            gap: 24px;
        }
       .original-text-container {
            background-color: var(--light-bg-color);
            padding: 16px; border-radius: 8px; border: 1px solid #eee;
        }
       .original-text-container h4 {
            margin: 0 0 12px 0; font-size: 14px; font-weight: 600;
            color: #555; display: flex; align-items: center; gap: 6px;
       }
       .original-text-container h4::before { content: 'üìÑ'; }
        p.original-text {
            font-size: 16px; line-height: 1.7; margin: 0;
            word-break: keep-all;
        }
       .analysis-input-container h4 {
            margin: 0 0 12px 0; font-size: 14px; font-weight: 600;
            color: var(--primary-color); display: flex; align-items: center; gap: 6px;
       }
        .analysis-input-container h4::before { content: '‚úçÔ∏è'; }

        textarea.analysis-input {
            width: 100%; height: 150px; padding: 12px;
            border: 1px solid var(--border-color); border-radius: 8px;
            font-family: var(--font-family); font-size: 15px;
            resize: vertical; box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea.analysis-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 128, 243, 0.2);
            outline: none;
        }
        textarea.analysis-input.invalid {
            border: 1px solid var(--danger-color);
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
        }
        /* --- [END v2.0] ÌõàÎ†® ÏÑπÏÖò --- */


        /* --- [v2.0] ÌîºÎìúÎ∞± Î¶¨Ìè¨Ìä∏ ÏÑπÏÖò --- */
        #feedback-report-section {
            width: 100%; max-width: 800px;
            padding: 0; box-sizing: border-box;
            animation: fadeIn 0.5s ease-out;
        }
        .report-header {
            text-align: center; padding: 32px;
            border-radius: 12px; /* v2.0: Ìó§Îçî ÏûêÏ≤¥Î•º Ïπ¥ÎìúÎ°ú */
        }
        .report-header h2 {
            font-size: 28px; margin: 0 0 8px 0;
            color: var(--primary-color); border-bottom: none;
        }
        #feedback-score-container { text-align: center; }
        #feedback-score {
            font-size: 96px; font-weight: 900;
            margin: 0; line-height: 1;
        }
       .score-s { color: var(--success-color); } /* 85+ */
       .score-a { color: var(--primary-color); } /* 60-84 */
       .score-b { color: var(--warning-color); } /* 40-59 */
       .score-c { color: var(--danger-color); }  /* 0-39 */
        #feedback-summary {
            font-size: 22px; font-weight: 600;
            margin-top: 8px; margin-bottom: 32px; color: #555;
        }

        /* [v2.0] Î†àÏù¥Îçî Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà - Ïà®ÍπÄ */
        #chart-container {
             display: none;
        }

        /* [v2.0] S-Class 1:1 ÏÉÅÏÑ∏ ÏΩîÏπ≠ */
        #detailed-review-container {
            display: flex;
            flex-direction: column;
            gap: 24px; /* Î¶¨Î∑∞ Ïπ¥Îìú ÏÇ¨Ïù¥ Í∞ÑÍ≤© */
        }
        .review-card {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden; /* Ìó§ÎçîÏùò ÎùºÏö¥Îìú ÏΩîÎÑà Ï†ÅÏö© */
        }
        .review-card-header {
            background-color: var(--light-bg-color);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .review-card-header h4 {
            margin: 0; font-size: 16px; font-weight: 700;
        }
        .review-card-body {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr; /* Ï¢å: ÎÇ¥ Î∂ÑÏÑù, Ïö∞: ÏΩîÏπò ÌîºÎìúÎ∞± */
            gap: 20px;
        }
        .review-card-body .original-text-container {
            /* 1:1 Î¶¨Î∑∞ÏóêÏÑúÎäî ÏõêÎ≥∏ ÌÖçÏä§Ìä∏Î•º Ìó§ÎçîÎ°ú Ïò¨Î†∏ÏúºÎØÄÎ°ú Ïà®ÍπÄ */
            display: none;
        }
        .user-analysis-box, .coach-feedback-box {
            background-color: var(--white-color);
            border-radius: 8px;
            padding: 16px;
        }
        .user-analysis-box {
            border: 1px solid var(--success-color);
            background-color: #f6fff8;
        }
        .coach-feedback-box {
            border: 1px solid var(--primary-color);
            background-color: #f7f9ff;
        }
        .review-card h5 {
            margin: 0 0 12px 0; font-size: 15px; font-weight: 600;
            display: flex; align-items: center; gap: 8px;
        }
        .user-analysis-box h5 { color: var(--success-color); }
        .user-analysis-box h5::before { content: '‚úîÔ∏è'; }
        .coach-feedback-box h5 { color: var(--primary-color); }
        .coach-feedback-box h5::before { content: 'üìà'; }

        .review-card p {
            margin: 0; font-size: 15px; line-height: 1.7;
            color: #444; word-break: keep-all;
        }
        .review-card p.empty-analysis {
            color: #888;
            font-style: italic;
        }

        /* ÌîºÎìúÎ∞± ÏöîÏïΩ Ìå®ÎÑê */
       .feedback-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            text-align: left;
            margin-bottom: 32px;
        }
       .feedback-panel {
            background-color: var(--light-bg-color);
            border-radius: 8px; padding: 24px;
        }
       .feedback-panel h3 {
            margin: 0 0 16px 0; font-size: 18px;
            display: flex; align-items: center;
            gap: 8px; font-weight: 700;
       }
        #good-points-panel h3 { color: var(--success-color); }
        #improvement-points-panel h3 { color: var(--warning-color); }
       .feedback-panel ul { list-style-type: none; padding: 0; margin: 0; }
       .feedback-panel li {
            margin-bottom: 12px; font-size: 15px; line-height: 1.7;
            padding-left: 20px; position: relative;
       }
       #good-points-panel li::before {
           content: 'üëç'; position: absolute; left: 0;
       }
        #improvement-points-panel li::before {
           content: 'üìà'; position: absolute; left: 0;
       }

        /* Ïï°ÏÖò ÌîåÎûú Î∞è ÏÖÄÌîÑ ÏΩîÏπ≠ */
        .action-plan-section, .self-coaching-section {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 12px; padding: 24px;
            margin-bottom: 24px;
        }
         .action-plan-section h3, .self-coaching-section h3 {
             font-size: 18px; font-weight: 700;
             margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;
             color: var(--primary-color);
         }
        .action-plan-section h3::before { content: 'üéØ'; }
        .self-coaching-section h3::before { content: 'ü§î'; }
         .action-plan-section p, .self-coaching-section p {
             font-size: 16px; line-height: 1.7; margin: 0; color: #555;
         }
         .self-coaching-section ul {
            list-style-type: none; padding: 0; margin-top: 12px;
         }
         .self-coaching-section li {
             margin-bottom: 8px; font-size: 15px; color: #555;
             padding-left: 20px; position: relative;
         }
         .self-coaching-section li::before {
              content: '‚ùì'; position: absolute; left: 0;
         }
        /* --- [END v2.0] ÌîºÎìúÎ∞± Î¶¨Ìè¨Ìä∏ --- */


        /* ÎèôÏ†Å Î°úÎçî Ïä§ÌÉÄÏùº */
        #dynamic-loader {
            text-align: center; padding: 48px;
            flex-direction: column; gap: 24px;
            align-items: center; justify-content: center;
        }
        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid var(--primary-color);
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        #loader-text {
            font-size: 18px; font-weight: 600;
            color: var(--text-color); margin: 0;
        }

        footer {
            text-align: center; padding: 20px;
            font-size: 14px; color: #999;
            margin-top: 40px;
        }

        .hidden { display: none !important; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
           .container { padding: 20px 15px; }
           header h1 { font-size: 28px; }
           header p { font-size: 16px; }
           .main-card, .chunk-card, .feedback-panel, .action-plan-section, .self-coaching-section { padding: 20px; }
           #text-input { height: 150px; }
           .course-options { flex-direction: column; }
           .chunk-card { grid-template-columns: 1fr; } /* ÌõàÎ†® Ïπ¥Îìú ÏÑ∏Î°ú Ï†ïÎ†¨ */
           #feedback-score { font-size: 72px; }
           #feedback-summary { font-size: 18px; }
           /* [v2.0] ÏÉÅÏÑ∏ Î¶¨Î∑∞ Ïπ¥Îìú ÏÑ∏Î°ú Ï†ïÎ†¨ */
           .review-card-body { grid-template-columns: 1fr; }
           .feedback-details { grid-template-columns: 1fr; } /* ÏöîÏïΩ Ìå®ÎÑê ÏÑ∏Î°ú Ï†ïÎ†¨ */
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Ï™ºÍ∞úÍ∏∞ ÎßàÏä§ÌÑ∞</h1>
            <p>Îß§Ïùº Ìïú Î¨∏Ïû•Ïî© Ï™ºÍ∞úÍ≥†, Ïª®ÌÖêÏ∏† ÎßàÏä§ÌÑ∞Í∞Ä ÎêòÏÑ∏Ïöî.</p>
        </header>

        <!-- Ïò§Î•ò Î∞∞ÎÑà -->
        <div id="error-banner" class="hidden">
            <p id="error-message">Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>
            <button id="error-close" type="button" aria-label="Îã´Í∏∞">&times;</button>
        </div>

        <!-- ÎèôÏ†Å Î°úÎçî -->
        <div id="dynamic-loader" class="main-card hidden">
            <div class="spinner"></div>
            <p id="loader-text">Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p>
        </div>

        <!-- 1. ÏûÖÎ†• ÏÑπÏÖò -->
        <div class="main-card" id="input-section">
            <h2>1. Î∂ÑÏÑùÌï† ÌÖçÏä§Ìä∏ ÏûÖÎ†•</h2>
            <textarea id="text-input" placeholder="Î∂ÑÏÑùÌïòÍ≥† Ïã∂ÏùÄ Î∏îÎ°úÍ∑∏ Í∏Ä, ÏòÅÏÉÅ ÎåÄÎ≥∏, Ïπ¥Ìîº Îì±ÏùÑ Ïó¨Í∏∞Ïóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî. (50Ïûê Ïù¥ÏÉÅ)"></textarea>
            <div id="char-counter">0 / 50Ïûê</div>

            <h2 style="margin-top: 32px;">2. ÌõàÎ†® ÏΩîÏä§ ÏÑ†ÌÉù</h2>
            <div class="course-options">
                <div class="course-option" data-course="quick">
                    <h3>Quick Course</h3>
                    <p>ÌïµÏã¨ ÏùòÎØ∏ 5Í∞ú Ï™ºÍ∞úÍ∏∞<br>(Ï†ÑÎûµÏ†Å ÌïµÏã¨ Ï†êÍ≤Ä)</p>
                </div>
                <div class="course-option" data-course="medium">
                    <h3>Medium Course</h3>
                    <p>Ï£ºÏöî ÏùòÎØ∏ 10Í∞ú Ï™ºÍ∞úÍ∏∞<br>(ÌïµÏã¨ ÎÖºÎ¶¨ ÏßëÏ§ë ÌõàÎ†®)</p>
                </div>
                <div class="course-option" data-course="full">
                    <h3>Full Course</h3>
                    <p>Ï†ÑÏ≤¥ ÌÖçÏä§Ìä∏ Ï™ºÍ∞úÍ∏∞<br>(Ïã¨Ï∏µ ÏßëÏ§ë ÌõàÎ†®)</p>
                </div>
            </div>

            <button id="start-split-button" class="btn" disabled>Ï™ºÍ∞úÍ∏∞ ÌõàÎ†® ÏãúÏûë</button>
        </div>

        <!-- 2. [v2.0] ÌõàÎ†® ÏÑπÏÖò (Ìè¨Ïª§Ïä§ Î™®Îìú) -->
        <div id="analysis-section" class="hidden">
            <h2>S-Class ÌõàÎ†®: Ìè¨Ïª§Ïä§ Î™®Îìú</h2>
            <p id="progress-indicator">0 / 0 Ìï≠Î™© Î∂ÑÏÑù Ï§ë</p>
            <!-- Îã®Ïùº ÌõàÎ†® Ïπ¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÏÇΩÏûÖÎê® -->
            <div id="analysis-inputs"></div>
            <!-- Îã§Ïùå Î≤ÑÌäº (v2.0) -->
            <button id="next-chunk-button" class="btn">Îã§Ïùå ÌõàÎ†® ‚ûî</button>
        </div>

        <!-- 3. [v2.0] ÏÑ±Ïû• Î¶¨Ìè¨Ìä∏ ÏÑπÏÖò -->
        <div id="feedback-report-section" class="hidden">
            <!-- Ï¥ùÏ†ê Ìó§Îçî -->
            <div class="main-card report-header">
                <h2>üìä ÏÑ±Ïû• Î¶¨Ìè¨Ìä∏</h2>
                 <div id="feedback-score-container">
                    <p style="font-size: 18px; font-weight: 600; color: #555; margin: 0;">ÎãπÏã†Ïùò Ï™ºÍ∞úÍ∏∞ Ïã§Î†•ÏùÄ...</p>
                    <div id="feedback-score"></div>
                    <p id="feedback-summary"></p>
                 </div>
            </div>

            <!-- [NEW] S-Class 1:1 ÏÉÅÏÑ∏ ÏΩîÏπ≠ -->
            <div class="main-card" style="margin-top: 24px;">
                <h2 style="text-align: center; margin-bottom: 8px;">S-Class 1:1 ÏÉÅÏÑ∏ ÏΩîÏπ≠</h2>
                <p style="text-align: center; margin-top: -8px; margin-bottom: 24px; font-size: 16px; color: #666;">
                    AI ÏΩîÏπòÍ∞Ä ÎãπÏã†Ïùò Î∂ÑÏÑùÏùÑ 1:1Î°ú Î¶¨Î∑∞ÌñàÏäµÎãàÎã§.
                </p>
                <div id="detailed-review-container">
                    <!-- ÏÉÅÏÑ∏ Î¶¨Î∑∞ Ïπ¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÇΩÏûÖÎê©ÎãàÎã§. -->
                </div>
            </div>

             <!-- ÌîºÎìúÎ∞± ÏöîÏïΩ -->
             <div class="main-card">
                 <h2 style="text-align: center;">üìà 4ÎåÄ Í∏∞Ï§Ä ÌèâÍ∞Ä (ÏöîÏïΩ)</h2>
                 
                 <!-- [DELETED] Î†àÏù¥Îçî Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà -->
                 <!-- <div id="chart-container"> ... </div> -->

                 <div class="feedback-details">
                    <div class="feedback-panel" id="good-points-panel">
                        <h3>ÏûòÌïú Ï†ê (ÏöîÏïΩ)</h3>
                        <ul id="good-points-list"></ul>
                    </div>
                    <div class="feedback-panel" id="improvement-points-panel">
                        <h3>Í∞úÏÑ†Ìï† Ï†ê (ÏöîÏïΩ)</h3>
                        <ul id="improvement-points-list"></ul>
                    </div>
                 </div>
            </div>

            <!-- Ïï°ÏÖò ÌîåÎûú -->
             <div class="action-plan-section">
                 <h3>üéØ Îã§Ïùå ÌõàÎ†® Î™©Ìëú Ï†úÏïà</h3>
                 <p id="action-plan-text"></p>
             </div>

             <!-- ÏÖÄÌîÑ ÏΩîÏπ≠ -->
             <div class="self-coaching-section">
                 <h3>ü§î Ïä§Ïä§Î°úÏóêÍ≤å ÏßàÎ¨∏Ìï¥Î≥¥ÏÑ∏Ïöî</h3>
                 <ul>
                    <li>Ïò§Îäò Î∞õÏùÄ 1:1 ÏÉÅÏÑ∏ ÏΩîÏπ≠ Ï§ë Í∞ÄÏû• ÎºàÏïÑÌîà ÌîºÎìúÎ∞±ÏùÄ Î¨¥ÏóáÏù∏Í∞Ä?</li>
                    <li>Ïù¥ ÌîºÎìúÎ∞±ÏùÑ ÎÇ¥Ïùº ÏûëÏÑ±Ìï† OOO ÏΩòÌÖêÏ∏†Ïóê Ïñ¥ÎñªÍ≤å Ï†ÅÏö©Ìï† Ïàò ÏûàÏùÑÍπå?</li>
                    <li>ÎÇòÏùò 'ÏûêÏùòÏãù'Ïù¥ AI ÏΩîÏπòÏùò ÌîºÎìúÎ∞±ÏùÑ ÎßâÍ≥† ÏûàÏßÄÎäî ÏïäÏùÄÍ∞Ä?</li>
                 </ul>
             </div>

             <button id="reset-button" class="btn btn-secondary">ÏÉàÎ°úÏö¥ ÌõàÎ†® ÏãúÏûë</button>
        </div>

    </div> 
    
    <footer>
        <p>¬© 2025 Jjokegi Master. Ïù¥ÏÉÅÌïúÎßàÏºÄÌåÖ Íµ¨ÏÑ±Ïõê Î∂ÑÎì§ÏùÑ ÏúÑÌï¥ ÎßåÎì§Ïñ¥Ï°åÏäµÎãàÎã§.</p>
    </footer>

    <script>
        // --- AI CONFIGURATION ---
        // !!! Ï§ëÏöî !!!: ÌÖåÏä§Ìä∏Î•º ÏúÑÌï¥ Ïã§Ï†ú Google AI StudioÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ API ÌÇ§Î•º "..." ÏïàÏóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî.
        const GEMINI_API_KEY = "AIzaSyCVTLte-n_F-83vTq3P1Fc16NzGXdKaIYI"; // ‚¨ÖÔ∏è Ïó¨Í∏∞Ïóê Ïã§Ï†ú API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;
        // ÎßåÏïΩ ÌÇ§Í∞Ä ÏóÜÎã§Î©¥, https://aistudio.google.com/app/apikey ÏóêÏÑú ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.
        
        // --- [v2.0] S-Class AI Prompts ---

        // Ï™ºÍ∞úÍ∏∞ ÌîÑÎ°¨ÌîÑÌä∏ (v1.2ÏôÄ ÎèôÏùº, Ïù¥ÎØ∏ SÍ∏â)
        const SPLIT_PROMPT = (text, mode) => {
            const coreInstruction = `
                You are an expert in Jacheong's 'Jjokegi Theory'. Your task is to analyze the *entire* text provided below to find the 'Minimum Viable Meaning Units' (ÏµúÏÜå ÏùòÎØ∏ Îã®ÏúÑ) that a master marketer would identify.
                A 'Minimum Viable Meaning Unit' is an individual claim, psychological hook, setup/payoff pair, problem-solution statement, or distinct persuasive argument. A single sentence may contain multiple meaning units.
            `;

            const modeInstruction = mode === 'quick'
               ? "After analyzing the *entire* text, extract *only* the 5 *most strategically important* meaning units from anywhere in the text. Do not just take the first 5."
               : (mode === 'medium'
                    ? "After analyzing the *entire* text, extract *only* the 10 *most strategically important* meaning units from anywhere in the text. Do not just take the first 10."
                    : "Deconstruct the *entire* text into *all* its meaning units, in the order they appear.");

            const outputInstruction = "Your output MUST be a JSON array of strings, with no other text, commentary, or explanation.";
            return `${coreInstruction}\n\n${modeInstruction}\n\n${outputInstruction}\n\nText to analyze:\n"""${text}"""\n\nOutput only the JSON array.`;
        };

        // --- [v2.0] S-Class ÌîºÎìúÎ∞± ÌîÑÎ°¨ÌîÑÌä∏ (ÏôÑÏ†Ñ Í∞úÌé∏) ---
        const FEEDBACK_PROMPT = (userAnalyses) => {
            return `
                You are an S-Class Senior Marketer at 'Isanghan Marketing', a 'Jjokegi Theory' master. Your task is to act as an S-Class Coach providing a detailed 1:1 code review for a junior marketer's training submission.
                Your feedback must be mercilessly sharp, logical, and strategic, but ultimately constructive, aimed at fostering rapid growth. Do not be polite or vague. Be direct and analytical.
                **All output text (summaries, plans, feedback) MUST be in KOREAN and contain NO markdown.**

                You will evaluate the user's submitted 'thought process' (user_analysis) for each 'original_chunk'.

                **Your process:**
                1.  Iterate through the *entire* \`userAnalyses\` array (which contains ${userAnalyses.length} items).
                2.  For **EACH** item, you MUST generate a \`specific_feedback\` string in KOREAN.
                3.  This \`specific_feedback\` MUST evaluate the user's analysis based on these S-Class criteria:
                    * **[Î≥∏Îä•/Î∞òÎ∞ï]** Í≥†Í∞ùÏùò ÌïµÏã¨ 'Î≥∏Îä•(ÎëêÎ†§ÏõÄ, ÏöïÎßù, LF8)'ÏùÑ Íø∞Îö´ÏóàÎäîÍ∞Ä? ÏòàÏÉÅ 'Î∞òÎ∞ï'ÏùÑ ÎÇ†Ïπ¥Î°≠Í≤å Ï†úÍ±∞ÌñàÎäîÍ∞Ä?
                    * **[Ïã¨Î¶¨/Ï†ÑÎûµ]** ÏÇ¨Ïö©Îêú Ïã¨Î¶¨ÌïôÏ†Å ÏõêÎ¶¨ÎÇò ÎßàÏºÄÌåÖ Ï†ÑÎûµ(Í∞ÄÏπò Ï¶ùÎ™Ö, ÌîÑÎ†àÏù¥Î∞ç Îì±)Ïù¥ Î™ÖÌôïÌïòÍ≥† ÏùòÎèÑÏ†ÅÏù∏Í∞Ä?
                    * **[Í≥†Í∞ù ÏÑ±Í≥µ]** Ïù¥ Î∂ÑÏÑùÏù¥ Í∂ÅÍ∑πÏ†ÅÏù∏ 'Í≥†Í∞ù ÏÑ±Í≥µ' Î∞è 'Îß§Ï∂ú'Ïóê Ïñ¥ÎñªÍ≤å Í∏∞Ïó¨ÌïòÎäîÏßÄ Ïó∞Í≤∞ÌñàÎäîÍ∞Ä?
                    * **[Í∞úÏÑ†Ï†ê]** (Í∞ÄÏû• Ï§ëÏöî) Ïù¥ Î∂ÑÏÑùÏù¥ Ïôú Î∂ÄÏ°±ÌïúÏßÄ, ÎòêÎäî Îçî ÎÇ†Ïπ¥Î°≠Í≤å Î∂ÑÏÑùÌñàÎã§Î©¥ Ïñ¥Îï†ÏùÑÏßÄ 'Í∞úÏÑ†Ìï† Ï†ê(Improvement)'ÏùÑ **Î∞òÎìúÏãú** Ìè¨Ìï®Ìï¥Îùº. (Ïòà: "Critique: ...Î∂ÑÏÑùÎßå ÏûàÍ≥†, ...Ïã¨Î¶¨ Ïó∞Í≤∞Ïù¥ Îπ†Ï°åÏùå.")

                4.  After reviewing all items, generate the overall summary:
                    * \`score\`: An overall integer score (0-100) based on the quality of all analyses.
                    * \`summary_good_points\`: An array of 2-3 strings (KOREAN) summarizing the user's main strengths.
                    * \`summary_improvement_points\`: An array of 2-3 strings (KOREAN) summarizing the user's biggest weaknesses.
                    * \`personalized_action_plan\`: A single string (KOREAN) proposing a *specific, actionable* next training goal based on the biggest weakness.

                **Your output MUST be a single, raw JSON object in the following structure. Do not add any other text or markdown.**

                \`\`\`json
                {
                  "score": 0,
                  "summary_good_points": [],
                  "summary_improvement_points": [],
                  "personalized_action_plan": "",
                  "detailed_review": [
                    {
                      "original_chunk": "...",
                      "user_analysis": "...",
                      "specific_feedback": "..."
                    }
                  ]
                }
                \`\`\`

                **User's Analyses to evaluate:**
                ${JSON.stringify(userAnalyses, null, 2)}
            `;
        };
        // --- [END v2.0] S-Class AI Prompts ---


        // --- DOM Elements ---
        const inputSection = document.getElementById('input-section');
        const analysisSection = document.getElementById('analysis-section');
        const feedbackReportSection = document.getElementById('feedback-report-section');
        
        const errorBanner = document.getElementById('error-banner');
        const errorMessage = document.getElementById('error-message');
        const errorClose = document.getElementById('error-close');
        const dynamicLoader = document.getElementById('dynamic-loader');
        const loaderText = document.getElementById('loader-text');

        const textInput = document.getElementById('text-input');
        const charCounter = document.getElementById('char-counter');
        const courseOptionsContainer = document.querySelector('.course-options');
        const courseOptions = document.querySelectorAll('.course-option');
        const startSplitButton = document.getElementById('start-split-button');
        
        // [v2.0] ÌõàÎ†® ÏÑπÏÖò ÏöîÏÜå
        const analysisInputsContainer = document.getElementById('analysis-inputs');
        const progressIndicator = document.getElementById('progress-indicator');
        const nextChunkButton = document.getElementById('next-chunk-button'); // v2.0 Î≤ÑÌäº ID Î≥ÄÍ≤Ω
        
        const resetButton = document.getElementById('reset-button');

        // [v2.0] ÌîºÎìúÎ∞± Î¶¨Ìè¨Ìä∏ ÏöîÏÜå
        const feedbackScoreEl = document.getElementById('feedback-score');
        const feedbackSummaryEl = document.getElementById('feedback-summary');
        // const feedbackChartCanvas = document.getElementById('feedback-radar-chart'); // [DELETED]
        const detailedReviewContainer = document.getElementById('detailed-review-container'); // [NEW]
        const goodPointsList = document.getElementById('good-points-list'); // (ÏöîÏïΩ)
        const improvementPointsList = document.getElementById('improvement-points-list'); // (ÏöîÏïΩ)
        const actionPlanText = document.getElementById('action-plan-text');

        // --- [v2.0] Ï†ÑÏó≠ ÏÉÅÌÉú Î≥ÄÏàò ---
        let selectedCourse = null;
        let originalChunks = [];
        let userAnalyses = []; // [v2.0] ÏÇ¨Ïö©ÏûêÏùò Î™®Îì† Î∂ÑÏÑùÏùÑ Ï†ÄÏû•
        let currentChunkIndex = 0; // [v2.0] ÌòÑÏû¨ ÌõàÎ†® Ï§ëÏù∏ Ï≤≠ÌÅ¨ Ïù∏Îç±Ïä§
        // let feedbackChart = null; // [DELETED]
        let loaderInterval = null;

        // --- Event Listeners ---
        textInput.addEventListener('input', () => {
            updateButtonState();
            updateCharCounter();
        });
        errorClose.addEventListener('click', () => errorBanner.classList.add('hidden'));

        courseOptions.forEach(option => {
            option.addEventListener('click', () => {
                courseOptions.forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                selectedCourse = option.dataset.course;
                updateButtonState();
            });
        });

        startSplitButton.addEventListener('click', handleStartSplit);
        nextChunkButton.addEventListener('click', handleNextChunk); // [v2.0]
        resetButton.addEventListener('click', resetUI);


        // --- Core Functions ---

        function showError(message) {
            errorMessage.textContent = safeHtml(message);
            errorBanner.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function updateCharCounter() {
            const length = textInput.value.length;
            charCounter.textContent = `${length} / 50Ïûê`;
            charCounter.classList.toggle('sufficient', length >= 50);
        }

        function updateButtonState() {
            startSplitButton.disabled = !(textInput.value.trim().length >= 50 && selectedCourse);
        }

        function showDynamicLoader(messages = ["Ï≤òÎ¶¨ Ï§ëÏûÖÎãàÎã§..."]) {
            let messageIndex = 0;
            loaderText.textContent = messages[messageIndex];
            if (loaderInterval) clearInterval(loaderInterval);
            loaderInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % messages.length;
                loaderText.textContent = messages[messageIndex];
            }, 2500);
            dynamicLoader.classList.remove('hidden');
        }

        function hideDynamicLoader() {
            if (loaderInterval) clearInterval(loaderInterval);
            loaderInterval = null;
            dynamicLoader.classList.add('hidden');
        }

        // [v2.0] ÌõàÎ†® ÏãúÏûë (Ï™ºÍ∞úÍ∏∞)
        async function handleStartSplit() {
            const text = textInput.value.trim();
            if (text.length < 50) {
                 showError("Î∂ÑÏÑùÌï† ÌÖçÏä§Ìä∏Î•º 50Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
                 return;
            }
            if (!selectedCourse) {
                showError("ÌõàÎ†® ÏΩîÏä§Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }

            startSplitButton.disabled = true;
            startSplitButton.textContent = 'AIÍ∞Ä Ï™ºÍ∞úÎäî Ï§ë...';
            inputSection.classList.add('hidden');
            showDynamicLoader([
                "AIÍ∞Ä ÌÖçÏä§Ìä∏Î•º Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...",
                "ÏµúÏÜå ÏùòÎØ∏ Îã®ÏúÑÎ°ú Ï™ºÍ∞úÍ≥† ÏûàÏäµÎãàÎã§...",
                "S-Class ÌõàÎ†®ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§..."
            ]);
            errorBanner.classList.add('hidden');

            try {
                const chunks = await callGeminiApi(SPLIT_PROMPT(text, selectedCourse));
                originalChunks = chunks;
                userAnalyses = new Array(chunks.length).fill(null); // Î∂ÑÏÑù Ï†ÄÏû• Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
                currentChunkIndex = 0; // 0Î≤àÎ∂ÄÌÑ∞ ÏãúÏûë
                
                displayCurrentChunk(); // Ï≤´ Î≤àÏß∏ ÌõàÎ†® Ïπ¥Îìú ÌëúÏãú
                
                analysisSection.classList.remove('hidden'); // Ìè¨Ïª§Ïä§ Î™®Îìú ÏÑπÏÖò ÌëúÏãú
            } catch (error) {
                console.error('Error splitting text:', error);
                showError(`ÌÖçÏä§Ìä∏Î•º Ï™ºÍ∞úÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`);
                inputSection.classList.remove('hidden');
            } finally {
                startSplitButton.disabled = false;
                startSplitButton.textContent = 'Ï™ºÍ∞úÍ∏∞ ÌõàÎ†® ÏãúÏûë';
                hideDynamicLoader();
            }
        }

        // [v2.0] ÌòÑÏû¨ ÌõàÎ†® Ï≤≠ÌÅ¨ ÌëúÏãú (Ìè¨Ïª§Ïä§ Î™®Îìú UI)
        function displayCurrentChunk() {
            if (currentChunkIndex >= originalChunks.length) return; // Î≤îÏúÑ Ï¥àÍ≥º Î∞©ÏßÄ

            const chunk = originalChunks[currentChunkIndex];
            const savedAnalysis = userAnalyses[currentChunkIndex]?.user_analysis || ''; // Ïù¥Ï†ÑÏóê Ï†ÄÏû•Îêú Í∞í Î°úÎìú
            const safeChunk = safeHtml(chunk);

            analysisInputsContainer.innerHTML = `
                <div class="chunk-card">
                    <div class="original-text-container">
                        <h4>#${currentChunkIndex + 1} ÏõêÎ≥∏ ÏùòÎØ∏ Îã®ÏúÑ</h4>
                        <p class="original-text">${safeChunk}</p>
                    </div>
                    <div class="analysis-input-container">
                        <h4>ÎÇòÏùò ÏÇ¨Í≥† Í≥ºÏ†ï Î∂ÑÏÑù</h4>
                        <textarea class="analysis-input" data-index="${currentChunkIndex}" placeholder="Ïù¥ Î¨∏Ïû•ÏùÑ Ïì¥ ÏùòÎèÑÎäî Î¨¥ÏóáÏù∏Í∞Ä?\nÍ≥†Í∞ùÏùò Ïñ¥Îñ§ Î∞òÎ∞ïÏùÑ Ï†úÍ±∞ÌïòÎ†§ ÌñàÎäîÍ∞Ä?\nÏñ¥Îñ§ Ïã¨Î¶¨ÌïôÏ†Å ÏõêÎ¶¨Î•º ÏÇ¨Ïö©ÌñàÎäîÍ∞Ä?">${safeHtml(savedAnalysis)}</textarea>
                    </div>
                </div>
            `;
            
            // ÏßÑÌñâÎ•† ÌëúÏãú
            progressIndicator.textContent = `${currentChunkIndex + 1} / ${originalChunks.length} Ìï≠Î™© Î∂ÑÏÑù Ï§ë`;

            // Î≤ÑÌäº ÌÖçÏä§Ìä∏ Î≥ÄÍ≤Ω
            if (currentChunkIndex === originalChunks.length - 1) {
                nextChunkButton.textContent = 'Î∂ÑÏÑù ÏôÑÎ£å & ÏÑ±Ïû• Î¶¨Ìè¨Ìä∏ Î≥¥Í∏∞';
            } else {
                nextChunkButton.textContent = 'Îã§Ïùå ÌõàÎ†® ‚ûî';
            }
        }

        // [v2.0] Îã§Ïùå ÌõàÎ†® / Î¶¨Ìè¨Ìä∏ Ï†úÏ∂ú
        function handleNextChunk() {
            const currentTextarea = analysisInputsContainer.querySelector('.analysis-input');
            const analysisText = currentTextarea.value.trim();
            
            // ÌòÑÏû¨ Î∂ÑÏÑù ÎÇ¥Ïö© Ï†ÄÏû•
            userAnalyses[currentChunkIndex] = {
                original_chunk: originalChunks[currentChunkIndex],
                user_analysis: analysisText // Îπà Í∞íÎèÑ Í∑∏ÎåÄÎ°ú Ï†ÄÏû•
            };

            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ (v1.2ÏôÄ ÎèôÏùºÌïòÍ≤å Ïú†ÏßÄ, Îπ®Í∞Ñ ÌÖåÎëêÎ¶¨)
            currentTextarea.classList.remove('invalid');
            if (!analysisText) {
                currentTextarea.classList.add('invalid');
                showError('ÏÇ¨Í≥† Í≥ºÏ†ï Î∂ÑÏÑùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return; // Îã§ÏùåÏúºÎ°ú ÎÑòÏñ¥Í∞ÄÏßÄ ÏïäÏùå
            }
            errorBanner.classList.add('hidden'); // ÏÑ±Í≥µ Ïãú Ïò§Î•ò Ïà®ÍπÄ


            // Îã§Ïùå Îã®Í≥ÑÎ°ú Ïù¥Îèô
            if (currentChunkIndex < originalChunks.length - 1) {
                currentChunkIndex++;
                displayCurrentChunk();
                window.scrollTo(0, 0); // ÏÉà Ïπ¥Îìú ÌëúÏãú Ïãú ÏÉÅÎã®ÏúºÎ°ú
            } else {
                // ÎßàÏßÄÎßâ ÌõàÎ†®Ïù¥ÏóàÏäµÎãàÎã§. ÌîºÎìúÎ∞± Î∞õÍ∏∞ Ïã§Ìñâ
                handleGetFeedback();
            }
        }

        // [v2.0] ÌîºÎìúÎ∞± Î∞õÍ∏∞ (Îç∞Ïù¥ÌÑ∞Îäî Ïù¥ÎØ∏ userAnalysesÏóê ÏûàÏùå)
        async function handleGetFeedback() {
            // v2.0: userAnalyses Î∞∞Ïó¥ÏùÄ Ïù¥ÎØ∏ ÏµúÏã† ÏÉÅÌÉúÏûÑ.
            // Î™®Îì† Ìï≠Î™©Ïù¥ Ï±ÑÏõåÏ°åÎäîÏßÄ ÎßàÏßÄÎßâÏúºÎ°ú ÌôïÏù∏ (handleNextChunkÏóêÏÑú Ïù¥ÎØ∏ ÌñàÏßÄÎßå Î∞©Ïñ¥ ÏΩîÎìú)
            const allFilled = userAnalyses.every(analysis => analysis && analysis.user_analysis.trim().length > 0);
            
            if (!allFilled) {
                showError('Î™®Îì† ÏÇ¨Í≥† Í≥ºÏ†ï Î∂ÑÏÑùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. ÎàÑÎùΩÎêú Ìï≠Î™©Ïù¥ ÏûàÏäµÎãàÎã§.');
                // ÎàÑÎùΩÎêú Ìï≠Î™©ÏúºÎ°ú ÎêòÎèåÏïÑÍ∞ÄÎäî Î°úÏßÅ (ÏÑ†ÌÉù ÏÇ¨Ìï≠)
                const firstEmptyIndex = userAnalyses.findIndex(a => !a || !a.user_analysis.trim());
                if(firstEmptyIndex !== -1) {
                    currentChunkIndex = firstEmptyIndex;
                    displayCurrentChunk();
                    // Ìï¥Îãπ ÏûÖÎ†•Ï∞ΩÏóê invalid ÌëúÏãú
                    setTimeout(() => {
                         const textarea = analysisInputsContainer.querySelector('.analysis-input');
                         if(textarea) textarea.classList.add('invalid');
                    }, 100);
                }
                return;
            }

            nextChunkButton.disabled = true;
            nextChunkButton.textContent = 'Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ï§ë...';
            analysisSection.classList.add('hidden');
            showDynamicLoader([
                "S-Class ÏΩîÏπòÍ∞Ä Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§...",
                "Î™®Îì† ÏÇ¨Í≥† Í≥ºÏ†ïÏùÑ Ï†ïÎ∞Ä Ï±ÑÏ†ê Ï§ëÏûÖÎãàÎã§...",
                "1:1 ÎßûÏ∂§Ìòï ÌîºÎìúÎ∞±ÏùÑ Íµ¨ÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§..."
            ]);
            errorBanner.classList.add('hidden');

            try {
                // v2.0: ÏÉàÎ°úÏö¥ S-Class ÌîÑÎ°¨ÌîÑÌä∏ Ìò∏Ï∂ú
                const feedback = await callGeminiApi(FEEDBACK_PROMPT(userAnalyses));
                displayFeedbackReport(feedback); // v2.0: ÏÉàÎ°úÏö¥ Î¶¨Ìè¨Ìä∏ ÌëúÏãú Ìï®Ïàò
                feedbackReportSection.classList.remove('hidden');
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error getting feedback:', error);
                showError(`ÌîºÎìúÎ∞±ÏùÑ Î∞õÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`);
                analysisSection.classList.remove('hidden');
            } finally {
                nextChunkButton.disabled = false;
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏Îäî displayCurrentChunk ÎòêÎäî resetUIÏóêÏÑú Í¥ÄÎ¶¨
            }
        }

        // --- [v2.0] Display Feedback Report (ÏôÑÏ†Ñ Í∞úÌé∏) ---
         function displayFeedbackReport(feedback) {
            if (typeof feedback !== 'object' || feedback === null || !feedback.detailed_review) {
                console.error("Invalid feedback format:", feedback);
                showError('AIÎ°úÎ∂ÄÌÑ∞ Ïú†Ìö®Ìïú JSON ÌîºÎìúÎ∞±ÏùÑ Î∞õÏßÄ Î™ªÌñàÏäµÎãàÎã§. (detailed_review ÎàÑÎùΩ)');
                analysisSection.classList.remove('hidden');
                return;
            }

            // v2.0: ÏÉàÎ°úÏö¥ JSON Íµ¨Ï°∞ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
            const {
                score = 0,
                summary_good_points = [],
                summary_improvement_points = [],
                personalized_action_plan = 'Îã§Ïùå ÌõàÎ†® Î™©ÌëúÎ•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî.',
                detailed_review = []
             } = feedback;

            // 1. Ï†êÏàò Î∞è Ï¥ùÌèâ ÏöîÏïΩ
            let scoreClass = 'score-c';
            if (score >= 85) scoreClass = 'score-s';
            else if (score >= 60) scoreClass = 'score-a';
            else if (score >= 40) scoreClass = 'score-b';

            let summary = 'ÏïÑÏßÅ Í∞úÏÑ†Ïù¥ ÎßéÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. 1:1 ÏΩîÏπ≠ÏùÑ ÍººÍººÌûà ÌôïÏù∏ÌïòÏÑ∏Ïöî.';
            if (score >= 85) summary = 'ÌõåÎ•≠Ìï©ÎãàÎã§! S-Class ÎßàÏºÄÌÑ∞Ïùò ÏÇ¨Í≥†Î∞©ÏãùÏù¥ Î≥¥ÏûÖÎãàÎã§.';
            else if (score >= 60) summary = 'Ï¢ãÏùÄ ÏãúÎèÑÏûÖÎãàÎã§. ÏÉÅÏÑ∏ ÏΩîÏπ≠ÏùÑ ÌÜµÌï¥ ÎÖºÎ¶¨Î•º Í∞ÄÎã§Îì¨ÏúºÏÑ∏Ïöî.';
            else if (score >= 40) summary = 'ÏÑ±Ïû•Ïùò Í∞ÄÎä•ÏÑ±Ïù¥ Î≥¥ÏûÖÎãàÎã§. ÌîºÎìúÎ∞±ÏùÑ ÌÜµÌï¥ ÌïµÏã¨ÏùÑ ÌååÏïÖÌïòÏÑ∏Ïöî.';

            feedbackScoreEl.textContent = `${score}Ï†ê`;
            feedbackScoreEl.className = scoreClass;
            feedbackSummaryEl.textContent = safeHtml(summary);

             // 2. [DELETED] Î†àÏù¥Îçî Ï∞®Ìä∏
             // renderRadarChart(criteria_scores);

             // 3. [NEW] 1:1 ÏÉÅÏÑ∏ ÏΩîÏπ≠ Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±
             detailedReviewContainer.innerHTML = ''; // Ïª®ÌÖåÏù¥ÎÑà ÎπÑÏö∞Í∏∞
             detailed_review.forEach((review, index) => {
                 const analysisHtml = review.user_analysis
                    ? `<p>${safeHtml(review.user_analysis)}</p>`
                    : `<p class="empty-analysis">Î∂ÑÏÑùÏùÑ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.</p>`;

                 const cardHtml = `
                    <div class="review-card">
                        <div class="review-card-header">
                            <h4>#${index + 1} ÏõêÎ≥∏: "${safeHtml(review.original_chunk.substring(0, 40))}..."</h4>
                        </div>
                        <div class="review-card-body">
                            <div class="user-analysis-box">
                                <h5>ÎÇòÏùò Î∂ÑÏÑù</h5>
                                ${analysisHtml}
                            </div>
                            <div class="coach-feedback-box">
                                <h5>S-Class ÏΩîÏπò ÌîºÎìúÎ∞±</h5>
                                <p>${safeHtml(review.specific_feedback)}</p>
                            </div>
                        </div>
                    </div>
                 `;
                 detailedReviewContainer.innerHTML += cardHtml;
             });


            // 4. (ÏöîÏïΩ) ÏÉÅÏÑ∏ ÌîºÎìúÎ∞± Î™©Î°ù ÌëúÏãú
            goodPointsList.innerHTML = summary_good_points.length > 0
                ? summary_good_points.map(p => `<li>${safeHtml(p)}</li>`).join('')
                : '<li>ÏöîÏïΩÎêú ÏûòÌïú Ï†êÏù¥ ÏóÜÏäµÎãàÎã§.</li>';
                
            improvementPointsList.innerHTML = summary_improvement_points.length > 0
                ? summary_improvement_points.map(p => `<li>${safeHtml(p)}</li>`).join('')
                : '<li>ÏöîÏïΩÎêú Í∞úÏÑ†Ìï† Ï†êÏù¥ ÏóÜÏäµÎãàÎã§.</li>';

             // 5. Ïï°ÏÖò ÌîåÎûú ÌëúÏãú
            actionPlanText.textContent = safeHtml(personalized_action_plan);
        }

        // --- [DELETED v2.0] Render Radar Chart ---
        /*
        function renderRadarChart(scores) { ... }
        */

        // --- [v2.0] Reset UI Function (ÏóÖÎç∞Ïù¥Ìä∏) ---
         function resetUI() {
            inputSection.classList.remove('hidden');
            analysisSection.classList.add('hidden');
            feedbackReportSection.classList.add('hidden');
            errorBanner.classList.add('hidden');
            hideDynamicLoader();

            textInput.value = '';
            courseOptions.forEach(o => o.classList.remove('selected'));
            selectedCourse = null;
            
            // v2.0: Ï†ÑÏó≠ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            originalChunks = [];
            userAnalyses = [];
            currentChunkIndex = 0;
            
            analysisInputsContainer.innerHTML = ''; // ÌõàÎ†® Ïπ¥Îìú Ï†úÍ±∞
            detailedReviewContainer.innerHTML = ''; // v2.0: ÏÉÅÏÑ∏ Î¶¨Î∑∞ Ï†úÍ±∞
            
            progressIndicator.textContent = '';
            nextChunkButton.textContent = 'Îã§Ïùå ÌõàÎ†® ‚ûî'; // v2.0: Î≤ÑÌäº ÌÖçÏä§Ìä∏ Ï¥àÍ∏∞Ìôî
            nextChunkButton.disabled = false; // v2.0: Î≤ÑÌäº ÌôúÏÑ±Ìôî

            startSplitButton.disabled = true;
            updateCharCounter();
            
            window.scrollTo(0, 0);
         }

        // --- API CALL LOGIC (v1.2ÏôÄ ÎèôÏùº, Ïù¥ÎØ∏ Í∞ïÎ†•Ìï®) ---
        async function callGeminiApi(prompt) {
            console.log("Sending prompt to API:", prompt);

            // API ÌÇ§ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            if (GEMINI_API_KEY === "YOUR_GEMINI_API_KEY") {
                showError("API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÉÅÎã®Ïùò 'GEMINI_API_KEY' Î≥ÄÏàòÎ•º ÏàòÏ†ïÌï¥Ï£ºÏÑ∏Ïöî.");
                throw new Error("API Key not set.");
            }

             let retries = 0;
             const maxRetries = 3;
             const baseDelay = 1000;

             while(retries < maxRetries) {
                 try {
                     const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: {
                                responseMimeType: "application/json",
                            },
                            safetySettings: [
                                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                            ]
                        })
                    });

                    if (!response.ok) {
                         if (response.status === 429 || response.status >= 500) {
                             retries++;
                             if (retries >= maxRetries) throw new Error(`API Ìò∏Ï∂úÏù¥ ${maxRetries}Î≤àÏùò Ïû¨ÏãúÎèÑ ÌõÑÏóêÎèÑ Ïã§Ìå®ÌñàÏäµÎãàÎã§ (Status: ${response.status}).`);
                             const delay = baseDelay * Math.pow(2, retries);
                             console.warn(`API call failed with status ${response.status}. Retrying in ${delay}ms... (${retries}/${maxRetries})`);
                             await new Promise(resolve => setTimeout(resolve, delay));
                             continue;
                         } else {
                            const errorBody = await response.text();
                            console.error("API Error Body:", errorBody);
                            throw new Error(`API Ìò∏Ï∂ú Ïã§Ìå®: ${response.status} ${response.statusText}`);
                         }
                    }

                    const data = await response.json();

                     if (!data.candidates || data.candidates.length === 0 ||!data.candidates[0].content ||!data.candidates[0].content.parts || data.candidates[0].content.parts.length === 0) {
                        if (data.candidates && data.candidates.length > 0 && data.candidates[0].finishReason === 'SAFETY') {
                            throw new Error("AIÍ∞Ä ÏïàÏ†ÑÏÉÅÏùò Ïù¥Ïú†Î°ú ÏùëÎãµÏùÑ Í±∞Î∂ÄÌñàÏäµÎãàÎã§.");
                        }
                        if (data.promptFeedback && data.promptFeedback.blockReason) {
                             throw new Error(`API ÏöîÏ≤≠Ïù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§: ${data.promptFeedback.blockReason}`);
                        }
                         console.error("Invalid API Response Structure:", data);
                         throw new Error("AIÎ°úÎ∂ÄÌÑ∞ Ïú†Ìö®Ìïú ÏùëÎãµ Íµ¨Ï°∞Î•º Î∞õÏßÄ Î™ªÌñàÏäµÎãàÎã§.");
                    }

                    const jsonString = data.candidates[0].content.parts[0].text;

                    try {
                        const parsedResult = JSON.parse(jsonString);
                        // v2.0: ÌîºÎìúÎ∞± ÌîÑÎ°¨ÌîÑÌä∏Îäî 'detailed_review' ÌÇ§Î•º Ìè¨Ìï®Ìïú Í∞ùÏ≤¥Ïó¨Ïïº Ìï®
                         if (prompt.includes('S-Class Coach') && (typeof parsedResult !== 'object' || parsedResult === null || !parsedResult.detailed_review)) {
                             console.error("Feedback prompt did not return a valid object with 'detailed_review':", parsedResult);
                             throw new Error("AIÍ∞Ä ÌîºÎìúÎ∞± Í≤∞Í≥ºÎ•º Í∞ùÏ≤¥ ÌòïÏãù(detailed_review Ìè¨Ìï®)ÏúºÎ°ú Î∞òÌôòÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.");
                         }
                        return parsedResult;
                    } catch (parseError) {
                        console.error("Failed to parse JSON response:", jsonString, parseError);
                        throw new Error("AIÍ∞Ä Ïú†Ìö®Ìïú JSON ÌòïÏãùÏùÑ Î∞òÌôòÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.");
                    }

                } catch (error) {
                    console.error("API Error during fetch or processing:", error);
                     if (retries >= maxRetries) throw error;
                    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError') || error.message.includes('API Key not set')) {
                        // API ÌÇ§ ÎØ∏ÏÑ§Ï†ï Ïãú Ïû¨ÏãúÎèÑ Ï§ëÏßÄ
                        if (error.message.includes('API Key not set')) throw error;

                        retries++;
                        const delay = baseDelay * Math.pow(2, retries);
                        console.warn(`API/Network error. Retrying in ${delay}ms... (${retries}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    } else {
                        throw error;
                    }
                }
             }
             throw new Error(`API Ìò∏Ï∂úÏù¥ ${maxRetries}Î≤àÏùò Ïû¨ÏãúÎèÑ ÌõÑÏóêÎèÑ Ïã§Ìå®ÌñàÏäµÎãàÎã§.`);
        }

        // Helper function for safe HTML display
        function safeHtml(text) {
          return text ? text.replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';
        }

        // Ï¥àÍ∏∞ Î°úÎìú
        updateCharCounter();
    </script>
</body>
</html>
